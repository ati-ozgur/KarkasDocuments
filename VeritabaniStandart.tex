\documentclass[10pt,a4paper,draft]{article}
\newcommand{\authorName}{Atilla \"Ozg\"ur}
\newcommand{\titleName}{Karkas SQL Server Veri tabanı Standartları}

\input{latexAndBibliography/usePackageAndDefinitions}


\begin{document}

\author{Atilla Özgür}
\title{Karkas SQL Server Veri Tabanı Standartları}

\maketitle

\section{Kurulum Notları}
Veritabanı kurulurken, SQL Server içinden Collation olarak Turkish\_CI\_AS 
seçilmelidir. Turkish\_CI\_AS Sunucu coallationu olarak seçilmelidir. 
Nchar unicode olarak değerleri tuttuğu için 2 katı yer kaplamakta ve daha yavaş çalışmaktadır. 
Eğer veritabanında aynı anda iki dil bilgisi tutulmayacaksa, yani hem rusça hemde türkçe bilgi,
yazi değerleri veri tabanında  varchar yada char olarak tutulmalıdır.


\section{Şema Kavramı}


SQL Server schema kavramını en iyi şekilde uygulayan veri tabanları arasındadır.
Bu yüzden schema yapısının SQL server veritabanı tasarımı yapılırken kullanılması tavsiye edilir.
Bu yapıda her ana modul için bir ana şema, bir tanım tablosu şeması açılması tavsiye edilmektedir.
Referential  Integrity korunması açısından bütün uygulama tek bir veritabanında çalışmalıdır.

Örneğin ihtiyaç duyduğunuz modullerin Insan Kaynakları, Muhasebe ve Bordro olduğunu düşünelim. 
Bu yapıda aşağıdaki şemaların açılması uygun olacaktır.
\begin{itemize}
\item MUHASEBE
\item TT\_MUHASEBE
\item INSAN\_KAYNAKLARI
\item TT\_INSAN\_KAYNAKLARI
\item BORDRO
\item TT\_BORDRO
\item ORTAK
\item TT\_ORTAK
\item OZLUK\_BILGILERI
\item TT\_OZLUK\_BILGILERI
\item FIRMALAR
\item TT\_FIRMALAR

\end{itemize}


Burada muhasebe, insan kaynakları ve bordro şemaları zaten ihtiyaç duyulan şemalardır.
Bunlara ek olarak kişi bilgilerinin tutulması için ad, soyad, kimlik bilgileri etc ORTAK şeması
önerilmektedir. TT\_ORTAK şeması buradaki bilgiler için gerekli tanım tablolarını tutacaktır.
Örneğin TT\_ORTAK.CINSIYET ismindeki bir tanım tablosu cinsiyet bilgileri tutabilir.
Burada Kisi için tutulacak bilgiler herkes için kesin tutulması gereken bilgilerdir. 
Örneğin ad soyad, tc kimlik no resim gibi. Ama eger sadece yazılımı kullanan kurumdaki,
kişilere ait  (örneğin kurum sicil no, kurum eposta, kurum telefon) gibi bilgiler  var ise 
bunların farklı şemada tutulması daha yararlı olacaktır. 

Buraya FIRMALAR şeması muhasebe firmalarının fatura kesecekleri firma bilgileri için eklenmiştir.
Firma, Kisi bilgileri bir çok modul tarafından ihtiyaç duyulan bilgiler oldukları için bunların
ayrı şemalarda tutulmaları daha yararlı olacaktır.

Son olarak Ozluk bilgileri, Bordro ve insan kaynaklarının ihtiyaç duydukları ortak bilgileri taşıyacaktır.
Burada bu bilgiler sadece insan kaynakları şeması yada bordro şeması yerine ikisinin ortak kullandığı
bir şemada olması daha uygundur.
Yani diğer bir deyişle; eğer bir tablo birden fazla modul tarafından kullanılıyor ise,
bu ortaklığı belirtecek yeni bir şema gerekirse açılmalıdır. 
Bu şema ismi eğer dışarıdan veri alınıyorsa bunu anlatan bir isim,
eğer 2 modulün ortak noktası ise, bu ortak nokta olabilir.
Sadece 2 modul tarafından kullanılacak bir tablo ORTAK şemasını eklenmemelidir.

Ana modul şemalarından 10 taneden fazla tablo bulunması bu modulun buyuk olduğunu göstermektedir.
Bu modul 2-3 ana modul olarak ayrılabilir. Örneğin personel için aşağıdaki gibi bir ayrım olabilir.
\begin{itemize}
\item PERSONEL
\item PERSONEL\_IZIN
\item PERSONEL\_HARCAMALAR
\end{itemize}




Her modul relationları, ilişkileri gösteren diagramlara sahip olmalıdır.
\missingfigure{Örnek diagram ekle}



\subsection{Şema, Tablo, Kolon İsimlendirme}

Şema ismi olarak kullandığınız isimleri tablo isimleri olarak kullanmayın. 
Yani eğer BORDRO diye bir şemanız varsa,	bu şema icinde veya 
diğer şemaların içinde BORDRO diye bir tablonuz olmamalıdır.

VS.NET içinde proje ismi olarak kullanacağınız bir ismi şema ismi  olarak kullanmayınız.
Yada şema isimlerinizi, VS.NET içinde	proje ismi  olarak vermeyin.
Derleyici (Compiler)  için sorunlar çıkarabiliyor.		 


Veritabanındaki Tablo ve Şema isimleri tüm harfler büyük, Kelimeler arasında ise \_ olacak şekilde seçilmelidir.

\begin{itemize}
\item INSAN\_KAYNAKLARI.ILAC\_ALIMI\_ALINAN\_ILACLAR		 
\item ORTAK.KISI\_EK\_BILGILER		 
\item MUHASEBE.FIS		 
\item MUHASEBE.FIS\_DETAY 

\end{itemize}


\subsubsection{Kolon İsimlendirme}
Kolon isimleri verilirken .NET isimlendir konvansiyonuna uygun olarak her kelime buyuk harf ile baslamalı,
diğer harfler kucuk harf olmalıdır.
Kolon isimleri kullanılırken türkçe karakterler (İ,Ü,ı ..) kullanılmamalıdır.
Bakınız aşağıdaki örnekler.


\begin{enumerate}
\item Ad
\item Soyad
\item IkinciAdi
\item TcKimlikNo
\item SehirNo
\end{enumerate}

Raporlama açısından bütün tablo'ların ve anlamı açık olmayan kolanların descriptionlarının yazılması tavsiye edilir.
Bu sayede veritabanından otomatik rapor çıkaran araçların raporları daha anlamlı olacaktır.
	
  
  
\subsubsection{Kolon İsimlendirme - Primary Key}
Primary key - Birincil anahtar isimlerinin nasıl olması gerektiğine proje başında karar verilmeli ve bu isimler
proje boyunca uyulmalıdır.
Buna göre birincil anahtar için aşağıdaki kelimelerden biri seçilmelidir.
\begin{enumerate}
\item Key
\item ID
\item Id
\end{enumerate}
Key anahtar, Id Identity (kimlik) kelimelerinin kısaltmasıdır.
Projede bunlardan sadece birinin kullanılması daha uygun olacaktır.
Aynı şekilde ID ve Id olarak karar verilmeli ve hep aynı şekilde kullanılmalıdır.

Aşağıdaki örneklerde Key kelimesinin seçilmiştir.

Birincil Anahtarları TABLO ADI + Key olarak verilmesi tavsiye edilmektedir.
Örneğin

\begin{tabular}{|l|l|}
\hline Tablo Adı & Primary Key Adı \\ 
\hline ORTAK.KISI & KisiKey \\ 
\hline MUHASEBE.FIS & FisKey \\ 
\hline BORDRO.ILAC\_ALIMI\_ALINAN\_ILACLAR & IlacAlimiAlinanIlaclarKey \\ 
\hline ORTAK.KISI\_EK\_BILGILER & KisiEkBilgilerKey \\ 
\hline 
\end{tabular} 


Eğer tanım tablolarının primary key'ı seçiliyor ise TabloIsmi + (No,Turu,TurNo,Tipi,TipNo)
gibi kolon isminden sonra türkçe okunmaya uygun bir ek kullanılmalıdır.

Örneğin

\begin{tabular}{|l|l|}
\hline Tablo Adı & Primary Key Adı \\ 
\hline TT\_ORTAK.Cinsiyet & CinsiyetTipNo \\ 
\hline TT\_ORTAK.SEHIR & SehirNo  \\ 
\hline TT\_OZGECMIS.EGITIM\_TIP & EgitimTipNo \\ 
\hline TT\_OZGECMIS.YABANCI\_DIL\_SINAV\_TUR & YabanciDilSinavTurNo \\ 
\hline 
\end{tabular} 


\subsubsection{Kolon İsimlendirme - Foreign Key}

Kolonlarda ikincil anahtar isimleri verilirken dikkat edilmesi gereken kural,
referans edilen tablonun bir tanım tablosumu yoksa bir ana tablomu olduğu kuralıdır.
Eğer bir ana tabloya referans veriliyorsa TabloIsmi + Key kullanılmalıdır.
Eğer bir tanım tablosuna referans veriliyorsa TabloIsmi + (No,Turu,TurNo,Tipi,TipNo)
gibi kolon isminden sonra türkçe okunmaya uygun bir ek kullanılmalıdır.
Bu sayede bir tablo incelenirken hangi tablolara referans verdiği daha rahat bir
sekilde anlaşılacaktır. 
Ayrıca verilen referansın bir tanım tablosunamı yoksa bir ana tabloyamı yapıldığı
daha iyi anlaşılacaktır.

Not eğer verilen ikincil anahtar kolonu bir iş gereği yüzünden ise,
kolon isminde bu durumun belirtilmesi ve aynı zamanda tablo isminin kullanılması daha iyi 
olur.

Örneğin Bilgi Edinme için tasarlanan tablo isimlerine bir bakalım.
\begin{itemize}

\item BILGI\_EDINME.DILEKCE
	\begin{itemize}
		\item DilekceKey
		\item BasvuruSahibiKisiKey
		\item GonderenIP
		\item DilekceIcerik
		\item CevapIstekTip
		\item GelisYoluTip
		\item VatandasBasvuruReferansKey
	\end{itemize}

\end{itemize}

Bu tabloyu okuduğumuzda DilekceKey primary key, 
BasvuruSahibiKisiKey ve VatandasBasvuruReferansKey ana tablolara referans eden foreign key,
CevapIstekTip ve GelisYoluTip tanım tablolarına referans eden bilgiler.

Burada BasvuruSahibiKisiKey ORTAK.KISI tablosuna buyuk ihtimal ile referans vermektedir.
KisiKey yerine BasvuruSahibiKisiKey kullanılması bu anahtarı dilekce basvuranı ifade ettiğini
göstermektedir. Bu anahtar kullanılarak kisi adı soyadı gibi bilgilere ulaşılabilir.

CevapIstekTip ve GelisYoluTip kolonları ile TT\_BILGI\_EDINME şemasında
CEVAP\_ISTEK ve GELIS\_YOLU isminde tablolar olduğunu biliyoruz.







\subsection{Kolon Veri Yapıları}

\subsubsection{Yazı Değerler}
Yazi degerleri eger değişken ise varchar ile, eğer sabit bir değer ise char olarak tutulmalıdır. Örneğin:

\begin{itemize}
\item Eğer bilgi girilen tip daima aynı sayıda ise örnek: Posta Kodu gibi char olarak tanımlanmalıdır.		 
\item Eğer bilgi girilen değer değişken bir değer ise, ad soyad gibi varchar olarak tanımlanmalıdır.
\end{itemize} 

Eğer veri tabanında kullanılan genel dilden (türkçe olmayan) farklı değer girilebilir ise nchar,nvarchar tanımlanmalıdır.


\subsubsection{Para ve Ondalık Değerler}

\begin{itemize}
\item  Money SQL standartında olmadığından kullanılmamalıdır. 
\item  Float ve double tam değerler değildir, yaklaşık değer olarak çalışırlar. 
Para hesaplarında kesinlikle kullanılmamaları gerekir.
\item Para değerleri numeric(18,2) veya decimal(18,2) olmalıdır. numeric ve decimal bir birlerinin alias'ıdır. 
\item Eğer para değerlerinde daha fazla küsürata ihtiyaç var ise   numeric(18,4)-decimal(18,4) gibi artırılabilir. 

\end{itemize} 
 			

\begin{itemize}
\item   Birincil anahtar (Primary Key) konulmayan tablo olmayacaktır.		 
\item   Tablolarda mümkün olduğunca girilen bilgiler not null yapılmalıdır.
\item   Tanım tablosundaki değer  -32,768 - 32,767   smallint veri yapısını kullanın.
\item   eğer tamsayı değer  -2,147,483,648 - 2,147,483,647 arası ise int veri yapısını kullanın.
\item   Eğer anlamlı bir default/varsayılan değer verilebiliyorsa verilmelidir. Örneğin GuncellemeTarih default now() verilebilir.
\item Primary key değerleri olarak uniqueidentifier veya Identity seçilmeli proje boyunca benzer bir yapı kullanılmalıdır.
\item Primary key Sentetik Anahtar (Surrogate Key) olarak int IDENTITY değerleri yerine uniqueidentifier tercih edilmesi,
kod yazılması kolaylığı açısından değerlendirilmeli ve proje başlangıcında karar verilmelidir.
\item   Uniqueidentifier eğer PK olarak kullanılıyorsa default değer olarak newid() olmalıdır.	 

\item   			Tarih bilgilerini tutarken smalldatetime tercih ediniz. 			
\item   Eğer sadece  yıl bilgisi tutacaksanız, Mezuniyet yılı smallint tutabilirsiniz. 
Bu tür bir kolona constraint ekleyin.örn: 
  $  CHECK  (([GirisSene]>=(1900) AND   [GirisSene]<=datepart(year,getdate()))) $
Yukarıdakı kısıtlama 
  giris senesinin 1900 ile şu an bulunduğumuz sene arasında kalmasını 
  sağlamaktadır.
\item Tarih değerleri 
\end{itemize}  			
  		 
  
  				datetime (3.33 milliseconds accuracy)  	Jan 1, 1753  	Dec 31, 9999
  				 <BR>				smalldatetime (1 minute accuracy) 	Jan 1, 1900 	Jun 6, 2079		
  				 <BR>değerleri arasını göstermektedir. .NET üstünde doğru kabul edilen, 
  örn: 01.01.1600 gibi bir değer SQL Server'da				hata verebilir. Tarih 
  Değerlerinin bu aralıkta olduğuna emin olunuz.						 
  			Resim veya binary data tutmak için varbinary(max) tercih edin. image 
  veri tipi SQL Server'ın yeni versiyonlarında			kullanılmayacaktır.		 
  			Eğer bir tablo içindeki kolon başka bir tabloya referans veriyorsa 
  kesinlikle foreign key tanımlanmalı ve bu			kolonun ismi TabloIsmiTipNo yada 
  TabloIsmiKey olarak tanımlanmalı. TipNo tanım tabloları için. Key ise normal 
  tablolar			için kullanılmalıdır.	
    TipNo yerine referans verilen tanımın türkçesine göre TurNo
    gibi diğer kelimelerde kullanılabilir.
    Eğer bir kolon ismi TurNo,TipNo,Turu,Tipi,RenkNo,BilgiNo
    gibi bir kelime ile bitiyorsa ise çok büyük ihtimal ile
    Tanım Tablolarına referans veriyordur.
    

  
  			TipNo(...) okunduğu zaman bir tanım tablosuna referans düşünülürken, Key ise 
  1..* veya 1..1 ilişkisini tanımlamalıdır.		 
  			Yazılım geliştiriciler için sınırlı yetkili veri tabanı kullanıcıları 
  açılacaktır. SQL Sever Management Studio üzerinde işlem			yapılırken bu 
  kullanıcı ile sisteme girilecektir.		 
  			Yazılım geliştiriciler Stored Procedure yazma gereksinimi duyarlarsa 
  bunu veritabanı yöneticisi ve takım liderlerinin onayını			 aldıktan sonra 
  yapabileceklerdir.		 
  			Stored Procudures usp\_ ile, functionlar ufn\_ ile, triggerler ise 
  utnX\_ ile başlamalıdır (X-->;i:insert, u:update, d:delete). 			
  
  
  Note: eğer bir 
  stored Procedure sp veya xp ile başlarsa SQL server 			bunun System stored 
  procedure'u olduğunu düşündüğü için ilk önce master veritabanında arayacaktır. 
  
  
  Stored Procudure'lara isim verirken tablo ismi + yaptığı işlem şeklinde 
  isim verin.
		usp\_Personel\_Ekle			usp\_Personel\_Sil			 
		usp\_Personel\_Guncelle		usp\_Personel\_Oku			 
		usp\_Personel\_Oku\_Tum		usp\_Personel\_Ara\_AdiVeSoyadiIle
  
     Table and View-Tablo ve Görüntü 
     -- 
    INSAN\_KAYNAKLARI.MUSTERI 
      			TANIM\_TABLOLARI.NUFUS\_CUZDANI\_VERILIS\_NEDENI 
    Schema ismi + Tablo ismi, 2 kelimeden fazla olan isimler \_ ile 
      ayrılıyor. Tablo ve Viewlara ayrı isimler vermiyoruz.		  
  
     Column-Kolon 
     -- 
    MusteriKey,TipNo,SonDegistirmeTarihi 
    Her kelimenin ilk harfi büyük yazılır. 
  
     Temp Table-Geçici Tablo 
     GECICI.TABLO\_ISMI 
    MusteriKey,TipNo,SonDegistirmeTarihi 
    Her kelimenin ilk harfi büyük yazılır. 
  
     Index isimlendirme 
     IX\_TabloIsmiKolonIsmi 
     IX\_MusteriMusteriNo 
    Her kelimenin ilk harfi büyük yazılır. 
  
     Yabancı anahtar (Foreign key) 
     FK\_TabloIsmi1KolonIsmi1FK\_TabloIsmi2KolonIsmi2 
     FK\_MusteriMusteriNoSiparisMusteriNo 
    Her kelimenin ilk harfi büyük yazılır. 
  
     Stored Procedure -Gömülü Yordamlar 
     usp\_ 
     usp\_PersonelAraAdiVeSoyadiIle 
     Tablo Ismi + yaptığı iş 		  
  
    Default - Varsayılan 
     DF\_ 
     DF\_PERSONEL\_IlkGirisTarihi 
     SQL Server DF veriyor. Management Studio icinde Default'ları 
      verirseniz, İsimlendirme düzgün olur. 		  
  
     Default - Varsayılan 
     CK\_ 
     CK\_OKUL\_BILGILERI\_GirisSenesi 
     SQL Server CK veriyor. Management Studio icinde Constarint 
      yazarsanız, İsimlendirme düzgün olur. 				 
  
     Trigger - Tetikleyici 
     utrX\_ 
     utru\_PERSONEL 
      utrX + Tablo Ismi, yerine triggerin hangi işlem için olduğunu 
      söyleyen bir kelime gelicektir. insert (i), update (u), delete (d)
  

  
      
      
Revision 
Yazarlar 
Yapılan Değişiklikler 
  
     0.2  
     Atilla Özgür 
    İlk Yazım 
    
  
     0.3 (2013-02-13) 
     Atilla Özgür 
    Çok uzun bir aradan sonra bazı düzeltmeler 
    
    


\end{document}
